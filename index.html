<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Blog do Jeiel Miranda">
    <meta name="robots" content="index, follow">
    <title>Jeiel Miranda Blog</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@1.0.0/css/bulma.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        pre {
            position: relative;
            padding: 1.25rem 1.5rem;
            background: #f5f5f5;
            border-radius: 6px;
            overflow-x: auto;
            white-space: pre;
            word-wrap: normal;
            margin-bottom: 1.5rem;
            line-height: 1.6;
        }
        pre code {
            background: transparent;
            padding: 0;
            font-size: inherit;
            color: inherit;
        }
        .copy-button {
            position: absolute;
            top: 0.75rem;
            right: 0.75rem;
            background: #4a4a4a;
            color: white;
            border: none;
            padding: 0.5em 0.75em;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.875em;
        }
        .copy-button:hover {
            background: #363636;
        }
        img {
            max-width: 100%;
            height: auto;
            border-radius: 4px;
        }
        .content img { /* Ensure images within content scale well */
             display: block;
             margin-left: auto;
             margin-right: auto;
             max-width: 80%; /* Adjust as needed */
             margin-top: 1.5rem;
             margin-bottom: 1.5rem;
        }
        .post-box {
            transition: box-shadow 0.3s ease-in-out, transform 0.3s ease-in-out;
        }
        .post-box:hover {
            box-shadow: 0 0.5em 1em -0.125em rgba(10, 10, 10, 0.2), 0 0px 0 1px rgba(10, 10, 10, 0.04);
            transform: translateY(-3px);
        }
        .post-meta .icon-text {
             color: #7a7a7a; /* Slightly softer grey for meta */
             font-size: 0.9rem;
        }
        .post-meta .icon {
             margin-right: 0.3em !important;
        }

        html.dark-mode {
            filter: invert(1) hue-rotate(180deg);
            background-color: #1a1a1a; /* Ensure bg is dark even with filter */
        }
        html.dark-mode body {
             background-color: inherit; /* Inherit from html */
        }
        html.dark-mode img,
        html.dark-mode video,
        html.dark-mode iframe,
        html.dark-mode .is-rounded,
        html.dark-mode .icon /* Prevent icons from double-inverting */ {
            filter: invert(1) hue-rotate(180deg);
        }
        html.dark-mode .box,
        html.dark-mode .input,
        html.dark-mode .button:not(.is-primary):not(.is-info):not(.is-success):not(.is-warning):not(.is-danger) {
            /* Adjust background slightly if needed, filter often handles it */
             border-color: #555; /* Darker border */
        }
         html.dark-mode pre {
             background-color: #2c2c2c;
             color: #e0e0e0;
             border: 1px solid #555;
         }
         html.dark-mode .copy-button {
             background: #555;
             color: #eee;
         }
         html.dark-mode .copy-button:hover {
             background: #666;
         }
         html.dark-mode .post-meta .icon-text {
             color: #aaa;
         }
         html.dark-mode .footer {
            background-color: #111 !important; /* Darker footer bg */
         }

         #dark-mode-toggle {
            font-size: 1.5rem;
            padding: 0.5rem;
            line-height: 1;
            background: none;
            border: none;
            cursor: pointer;
            color: white; /* Ensure visible on header */
         }
         html.dark-mode #dark-mode-toggle {
             color: inherit; /* Let filter handle color */
         }
         .search-wrapper {
            max-width: 720px; /* Slightly wider search */
            margin-left: auto;
            margin-right: auto;
         }
    </style>
</head>
<body>
    <header class="hero is-link is-small mb-5">
        <div class="hero-body">
            <div class="container">
                 <div class="level is-mobile">
                    <div class="level-left">
                        <div class="level-item">
                            <figure class="image is-48x48">
                                <img src="https://jeiel.pages.dev/assets/jeiel-DLoUMvkh.png" alt="Foto de Perfil" class="is-rounded">
                            </figure>
                        </div>
                        <div class="level-item">
                             <h1 class="title is-2 has-text-white">Meu Blog</h1>
                        </div>
                    </div>
                    <div class="level-right">
                        <div class="level-item">
                            <button id="dark-mode-toggle" aria-label="Alternar modo escuro">üåô</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <main class="section pt-0">
        <div class="container">
            <div class="field search-wrapper mb-6">
                <div class="control has-icons-left">
                    <input class="input is-medium" type="text" id="search-input" placeholder="Pesquisar por t√≠tulo...">
                    <span class="icon is-left">
                      <i class="fas fa-search"></i>
                    </span>
                </div>
            </div>

            <div id="posts-list" class="mb-5"></div>

            <div class="has-text-centered">
                <button id="load-more" class="button is-info is-medium mt-4 is-hidden">
                    <span class="icon">
                        <i class="fas fa-plus"></i>
                    </span>
                    <span>Carregar mais</span>
                </button>
            </div>


            <div id="post-detail" class="is-hidden">
                <button id="back-button" class="button is-link is-light mb-5">
                     <span class="icon">
                       <i class="fas fa-arrow-left"></i>
                     </span>
                     <span>Voltar para a lista</span>
                </button>
                <div id="post-content"></div>
            </div>
        </div>
    </main>

    <footer class="footer has-background-grey-darker has-text-light mt-6">
         <div class="container">
             <div class="level">
                 <div class="level-left">
                     <div class="level-item">
                         <p>&copy; 2024-2025 Jeiel Miranda</p>
                     </div>
                 </div>
                 <div class="level-right">
                     <div class="level-item">
                         <a href="https://github.com/Jeiel0rbit" class="has-text-info" target="_blank" rel="noopener noreferrer">GitHub</a>&nbsp;|&nbsp;
                         <a href="http://jeiel.pages.dev/" class="has-text-info" target="_blank" rel="noopener noreferrer">Link Bio</a>&nbsp;|&nbsp;
                         <a href="http://quiz-jeiel.vercel.app/" class="has-text-info" target="_blank" rel="noopener noreferrer">Quiz B√≠blico</a>
                     </div>
                 </div>
             </div>
         </div>
     </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const postsList = document.getElementById('posts-list');
            const postDetail = document.getElementById('post-detail');
            const postContent = document.getElementById('post-content');
            const backButton = document.getElementById('back-button');
            const loadMoreButton = document.getElementById('load-more');
            const searchInput = document.getElementById('search-input');
            const searchWrapper = document.querySelector('.search-wrapper');
            const darkModeToggle = document.getElementById('dark-mode-toggle');
            const htmlElement = document.documentElement;
            let posts = [];
            let allFetchedPosts = [];
            let visiblePosts = 5;
            const POSTS_PER_PAGE = 5;

            function applyTheme(theme) {
                if (theme === 'dark') {
                    htmlElement.classList.add('dark-mode');
                    darkModeToggle.textContent = '‚òÄÔ∏è';
                    darkModeToggle.setAttribute('aria-label', 'Alternar para modo claro');
                } else {
                    htmlElement.classList.remove('dark-mode');
                    darkModeToggle.textContent = 'üåô';
                     darkModeToggle.setAttribute('aria-label', 'Alternar para modo escuro');
                }
            }

            const savedTheme = localStorage.getItem('theme') || 'light';
            applyTheme(savedTheme);

            darkModeToggle.addEventListener('click', () => {
                const currentTheme = htmlElement.classList.contains('dark-mode') ? 'dark' : 'light';
                const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                localStorage.setItem('theme', newTheme);
                applyTheme(newTheme);
            });

            async function fetchPosts() {
                try {
                    const response = await fetch('https://www.tabnews.com.br/api/v1/contents/JeielMiranda?with_children=false');
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const fetchedPosts = await response.json();

                    allFetchedPosts = fetchedPosts
                        .filter(post => post.status === 'published' && post.title && post.published_at)
                        .sort((a, b) => new Date(b.published_at) - new Date(a.published_at));

                    posts = allFetchedPosts;
                    renderPosts();
                } catch (error) {
                    console.error('Erro ao buscar posts:', error);
                    postsList.innerHTML = '<div class="notification is-danger has-text-centered">Erro ao carregar conte√∫do. Tente novamente mais tarde.</div>';
                }
            }

            function renderPosts(filteredPosts = null) {
                postsList.innerHTML = '';
                const postsToRender = (filteredPosts !== null ? filteredPosts : posts).slice(0, visiblePosts);

                postsToRender.forEach(post => {
                    if (!post.title) return;

                    const postElement = document.createElement('article');
                    postElement.className = 'box post-box mb-5'; // Added post-box for hover effects

                    postElement.innerHTML = `
                        <h2 class="title is-4 mb-2">
                            <a href="#" class="has-text-link post-link" data-slug="${post.slug}">${post.title}</a>
                        </h2>
                        <div class="post-meta level is-mobile mt-3">
                            <div class="level-left">
                                <div class="level-item">
                                    <span class="icon-text">
                                        <span class="icon"><i class="fas fa-calendar-alt"></i></span>
                                        <span>${new Date(post.published_at).toLocaleDateString()}</span>
                                    </span>
                                </div>
                            </div>
                            <div class="level-right">
                                <div class="level-item mr-3">
                                    <span class="icon-text">
                                        <span class="icon"><i class="fas fa-star"></i></span>
                                        <span>${post.tabcoins ?? 0}</span>
                                    </span>
                                </div>
                                <div class="level-item">
                                    <span class="icon-text">
                                        <span class="icon"><i class="fas fa-comments"></i></span>
                                        <span>${post.children_deep_count ?? 0}</span>
                                    </span>
                                </div>
                            </div>
                        </div>
                    `;

                    postsList.appendChild(postElement);
                });

                const sourceArray = filteredPosts !== null ? filteredPosts : posts;
                if (sourceArray.length > visiblePosts) {
                    loadMoreButton.classList.remove('is-hidden');
                } else {
                    loadMoreButton.classList.add('is-hidden');
                }

                document.querySelectorAll('.post-link').forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        const slug = e.target.getAttribute('data-slug');
                        showPostDetail(slug);
                    });
                });
            }

            async function showPostDetail(slug) {
                try {
                    const response = await fetch(`https://www.tabnews.com.br/api/v1/contents/JeielMiranda/${slug}`);
                     if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const post = await response.json();

                    if (!post || !post.body) {
                        postContent.innerHTML = '<div class="notification is-warning has-text-centered">Conte√∫do n√£o dispon√≠vel.</div>';
                        return;
                    }

                    const contentHtml = marked.parse(post.body || 'Conte√∫do n√£o dispon√≠vel.');
                    postContent.innerHTML = `
                        <div class="box content">
                            <h1 class="title is-2 mb-3">${post.title}</h1>
                            <div class="post-meta level is-mobile is-size-6 has-text-grey mb-5">
                                <div class="level-left">
                                    <div class="level-item">
                                        <span class="icon-text">
                                            <span class="icon"><i class="fas fa-calendar-alt"></i></span>
                                            <span>${new Date(post.published_at).toLocaleDateString()}</span>
                                        </span>
                                    </div>
                                </div>
                                <div class="level-right">
                                    <div class="level-item mr-3">
                                        <span class="icon-text">
                                            <span class="icon"><i class="fas fa-star"></i></span>
                                            <span>${post.tabcoins ?? 0} TabCoins</span>
                                        </span>
                                    </div>
                                    <div class="level-item">
                                        <span class="icon-text">
                                            <span class="icon"><i class="fas fa-comments"></i></span>
                                            <span>${post.children_deep_count ?? 0} Coment√°rios</span>
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <hr class="mb-5">
                            <div>${contentHtml}</div>
                            <hr class="mt-5">
                            <a href="https://www.tabnews.com.br/JeielMiranda/${post.slug}" class="button is-link is-outlined mt-4" target="_blank" rel="noopener noreferrer">
                                <span class="icon"><i class="fas fa-external-link-alt"></i></span>
                                <span>Ver no TabNews</span>
                            </a>
                        </div>
                    `;

                     document.querySelectorAll('#post-content pre code').forEach((block) => {
                        const preElement = block.parentElement;
                        if (preElement && preElement.tagName === 'PRE') {
                             preElement.style.position = 'relative'; // Ensure parent is positioned
                             const button = document.createElement('button');
                             button.className = 'copy-button';
                             button.textContent = 'Copiar';
                             button.onclick = () => {
                                 navigator.clipboard.writeText(block.textContent || '').then(() => {
                                     button.textContent = 'Copiado!';
                                     button.disabled = true;
                                     setTimeout(() => {
                                        button.textContent = 'Copiar';
                                        button.disabled = false;
                                     }, 2000);
                                 }).catch(err => {
                                    console.error('Erro ao copiar:', err);
                                    button.textContent = 'Erro';
                                    setTimeout(() => {
                                        button.textContent = 'Copiar';
                                        button.disabled = false;
                                    }, 2000);
                                 });
                             };
                             preElement.appendChild(button);
                        }
                     });

                    postsList.classList.add('is-hidden');
                    loadMoreButton.parentElement.classList.add('is-hidden'); // Hide the button's container
                    searchWrapper.classList.add('is-hidden');
                    postDetail.classList.remove('is-hidden');
                    window.scrollTo(0, 0);
                } catch (error) {
                    console.error('Erro ao buscar post:', error);
                    postContent.innerHTML = '<div class="notification is-danger has-text-centered">Erro ao carregar este post.</div>';
                }
            }

            backButton.addEventListener('click', () => {
                postDetail.classList.add('is-hidden');
                postsList.classList.remove('is-hidden');
                loadMoreButton.parentElement.classList.remove('is-hidden'); // Show the button's container
                searchWrapper.classList.remove('is-hidden');
                visiblePosts = POSTS_PER_PAGE;
                const currentQuery = searchInput.value.toLowerCase();
                if (currentQuery) {
                    const filtered = allFetchedPosts.filter(post =>
                        post.title && post.title.toLowerCase().includes(currentQuery)
                    );
                     renderPosts(filtered);
                } else {
                    renderPosts(allFetchedPosts);
                }
            });

            loadMoreButton.addEventListener('click', () => {
                visiblePosts += POSTS_PER_PAGE;
                const currentQuery = searchInput.value.toLowerCase();
                 if (currentQuery) {
                    const filtered = allFetchedPosts.filter(post =>
                        post.title && post.title.toLowerCase().includes(currentQuery)
                    );
                    renderPosts(filtered);
                 } else {
                     renderPosts(allFetchedPosts);
                 }
            });

            searchInput.addEventListener('input', () => {
                const query = searchInput.value.toLowerCase();
                visiblePosts = POSTS_PER_PAGE;
                const filteredPosts = allFetchedPosts.filter(post =>
                    post.title && post.title.toLowerCase().includes(query)
                );
                posts = filteredPosts; // Update the base 'posts' for subsequent loads if filtering
                renderPosts(filteredPosts);
                if (!query) {
                    posts = allFetchedPosts; // Reset if search is cleared
                    renderPosts(allFetchedPosts);
                }
            });

            fetchPosts();
        });
    </script>
</body>
</html>
